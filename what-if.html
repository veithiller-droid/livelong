<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dr. Livelong - What-If Simulator: Teste verschiedene Lifestyle-Ã„nderungen und ihre Auswirkungen">
    <title>Dr. Livelong - What-If Simulator</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒˆ</text></svg>">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
</head>
<body>
    <!-- Background Circles -->
    <div class="background-circles">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
        <div class="circle circle-4"></div>
        <div class="circle circle-5"></div>
        <div class="circle circle-6"></div>
    </div>

    <!-- Header with Language Selector -->
    <header>
        <div class="logo">ğŸŒˆ Dr. Livelong</div>
        
        <div class="language-selector">
            <button class="lang-btn" data-lang="de">ğŸ‡©ğŸ‡ª</button>
            <button class="lang-btn" data-lang="en">ğŸ‡¬ğŸ‡§</button>
            <button class="lang-btn" data-lang="es">ğŸ‡ªğŸ‡¸</button>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <a href="profile.html" class="btn btn-secondary" data-i18n="btn_profile">Profil</a>
            <a href="result.html" class="btn btn-secondary" data-i18n="btn_result">Ergebnis</a>
        </div>
    </header>

    <!-- What-If Container -->
    <div id="whatif-container" class="container section">
        <!-- what_if_engine.js renders everything here -->
    </div>

    <!-- Language Selector Styles -->
    <style>
        .language-selector {
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px;
            border-radius: 20px;
        }

        .lang-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 16px;
            transition: all 0.3s ease;
            filter: grayscale(1) opacity(0.5);
        }

        .lang-btn:hover {
            filter: grayscale(0) opacity(0.8);
            transform: scale(1.1);
        }

        .lang-btn.active {
            background: var(--gradient-primary);
            filter: grayscale(0) opacity(1);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        @media (max-width: 768px) {
            header {
                flex-wrap: wrap;
                gap: 15px;
            }

            .language-selector {
                order: 3;
                width: 100%;
                justify-content: center;
            }

            header > div:last-child {
                order: 4;
                width: 100%;
                justify-content: center;
            }
        }
    </style>

    <!-- JavaScript -->
    <script type="module">
        import { renderWhatIf } from './js/ui/what_if_engine.js';
        import { checkAccess } from './js/ui/paywall.js';
        import { getCalculation } from './js/core/state.js';

        // i18n Texts
        const TEXTS = {
            de: {
                btn_profile: 'Profil',
                btn_result: 'Ergebnis',
                no_access_title: 'Premium Feature ğŸŒŸ',
                no_access_message: 'Der What-If Simulator ist nur in der Premium-Version verfÃ¼gbar. Schalte jetzt frei und teste verschiedene Lifestyle-Ã„nderungen!',
                btn_unlock: 'Premium freischalten',
                no_result_title: 'Kein Ergebnis gefunden',
                no_result_message: 'Bitte fÃ¼hre zuerst den Test durch, um den What-If Simulator nutzen zu kÃ¶nnen.',
                btn_start_test: 'Zum Test'
            },
            en: {
                btn_profile: 'Profile',
                btn_result: 'Result',
                no_access_title: 'Premium Feature ğŸŒŸ',
                no_access_message: 'The What-If Simulator is only available in the Premium version. Unlock now and test different lifestyle changes!',
                btn_unlock: 'Unlock Premium',
                no_result_title: 'No result found',
                no_result_message: 'Please complete the test first to use the What-If Simulator.',
                btn_start_test: 'Start Test'
            },
            es: {
                btn_profile: 'Perfil',
                btn_result: 'Resultado',
                no_access_title: 'FunciÃ³n Premium ğŸŒŸ',
                no_access_message: 'El Simulador What-If solo estÃ¡ disponible en la versiÃ³n Premium. Â¡Desbloquea ahora y prueba diferentes cambios de estilo de vida!',
                btn_unlock: 'Desbloquear Premium',
                no_result_title: 'No se encontrÃ³ resultado',
                no_result_message: 'Por favor completa el test primero para usar el Simulador What-If.',
                btn_start_test: 'Iniciar Test'
            }
        };

        // Get current language
        let currentLang = localStorage.getItem('dr_livelong_lang') || 'de';

        // Update language
        function updateLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('dr_livelong_lang', lang);
            document.documentElement.lang = lang;

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (TEXTS[lang] && TEXTS[lang][key]) {
                    el.textContent = TEXTS[lang][key];
                }
            });

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                }
            });
        }

        // Language selector
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                updateLanguage(btn.getAttribute('data-lang'));
                // Reload page to re-render in new language
                location.reload();
            });
        });

        // Check access and calculation
        const hasAccess = checkAccess();
        const calculation = getCalculation();
        const container = document.getElementById('whatif-container');

        if (!calculation) {
            // No result found
            container.innerHTML = `
                <div class="card" style="text-align: center; max-width: 600px; margin: 100px auto;">
                    <div style="font-size: 64px; margin-bottom: 20px;">âŒ</div>
                    <h2 data-i18n="no_result_title">${TEXTS[currentLang].no_result_title}</h2>
                    <p data-i18n="no_result_message" style="color: var(--text-medium); margin: 20px 0;">
                        ${TEXTS[currentLang].no_result_message}
                    </p>
                    <a href="meta.html" class="btn btn-primary btn-large" data-i18n="btn_start_test">
                        ${TEXTS[currentLang].btn_start_test}
                    </a>
                </div>
            `;
        } else if (!hasAccess) {
            // No access - show premium message
            container.innerHTML = `
                <div class="card" style="text-align: center; max-width: 600px; margin: 100px auto;">
                    <div style="font-size: 64px; margin-bottom: 20px;">ğŸ”®</div>
                    <h2 data-i18n="no_access_title">${TEXTS[currentLang].no_access_title}</h2>
                    <p data-i18n="no_access_message" style="color: var(--text-medium); margin: 20px 0;">
                        ${TEXTS[currentLang].no_access_message}
                    </p>
                    
                    <!-- Preview Features -->
                    <div style="text-align: left; margin: 30px 0;">
                        <h3 style="font-size: 20px; margin-bottom: 15px;">Was du testen kannst:</h3>
                        <div style="display: grid; gap: 10px;">
                            <div style="padding: 12px; background: rgba(255,107,107,0.1); border-radius: 12px; border-left: 4px solid var(--color-coral);">
                                ğŸš­ <strong>Rauchen aufhÃ¶ren</strong> - Wie viele Jahre gewinnst du?
                            </div>
                            <div style="padding: 12px; background: rgba(78,205,196,0.1); border-radius: 12px; border-left: 4px solid var(--color-turquoise);">
                                ğŸƒ <strong>Sport starten</strong> - Effekt von regelmÃ¤ÃŸiger Bewegung
                            </div>
                            <div style="padding: 12px; background: rgba(168,230,207,0.1); border-radius: 12px; border-left: 4px solid var(--color-mint);">
                                ğŸ¥— <strong>ErnÃ¤hrung verbessern</strong> - Mediterrane DiÃ¤t & mehr
                            </div>
                            <div style="padding: 12px; background: rgba(199,163,255,0.1); border-radius: 12px; border-left: 4px solid var(--color-purple);">
                                ğŸ˜´ <strong>Schlaf optimieren</strong> - Besserer Schlaf = lÃ¤ngeres Leben
                            </div>
                            <div style="padding: 12px; background: rgba(255,230,109,0.1); border-radius: 12px; border-left: 4px solid var(--color-yellow);">
                                ğŸ”® <strong>Kombinations-Szenarien</strong> - Teste mehrere Ã„nderungen gleichzeitig
                            </div>
                        </div>
                    </div>
                    
                    <a href="result.html" class="btn btn-primary btn-large pulse" data-i18n="btn_unlock" style="margin-top: 20px;">
                        ${TEXTS[currentLang].btn_unlock}
                    </a>
                </div>
            `;
        } else {
            // Has access - render what-if simulator
            updateLanguage(currentLang);
            renderWhatIf();
        }

        // Check URL for access token (for future backend integration)
        const urlParams = window.location.pathname.split('/');
        if (urlParams[1] === 'what-if' && urlParams[2]) {
            const token = urlParams[2];
            console.log('What-If token from URL:', token);
            // Future: Load profile from backend using token
        }
    </script>
</body>
</html>